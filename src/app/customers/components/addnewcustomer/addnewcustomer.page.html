<ion-content [fullscreen]="true">
  <ng-toast></ng-toast>
  <div class="items-center justify-center mx-4 py-4">
    <form #customerForm="ngForm" (ngSubmit)="showModal()">
      <h1 class="text-2xl text-neutral-50 flex-1 text-center">
        Adding a new customer
      </h1>

      <p class=".pcustom flex-1 py-2 mx-3 text-center">
        Please fill in the following customer information.
      </p>

      <div class="my-3">
        <label for="first-name" class="block mx-1 text-lg text-neutral-50">First Name</label>
        <input type="text" id="firstname" [(ngModel)]="customer.first_name" #firstname="ngModel" name="firstname"
          minlength="2" pattern="^[A-Za-zÅÄÖåäöØøÆæÐð-]+$"
          class="text-slate-50 bg-slate-700 border border-gray-300 rounded-lg focus:ring-slate-500 focus:border-slate-500 block w-full p-2.5"
          placeholder="Enter firstname" required />

        @if (firstname.invalid && (firstname.touched )) {
        <p class="pwarning">
          Please fill in a valid first name.
        </p>
        }
      </div>

      <div class="my-3">
        <label for="last-name" class="block mx-1 text-lg text-neutral-50">Last Name</label>
        <input type="text" id="lastname" [(ngModel)]="customer.last_name" #lastname="ngModel" name="lastname"
          minlength="2" pattern="^[A-Za-zÅÄÖåäöØøÆæÐð-]+$"
          class="bg-slate-700 border border-gray-300 text-slate-50 rounded-lg focus:ring-slate-500 focus:border-slate-500 block w-full p-2.5"
          placeholder="Enter lastname" required />

        @if (lastname.invalid && lastname.touched) {
        <p class="pwarning">
          Please fill in a valid last name.
        </p>
        }
      </div>

      <div class="my-3">
        <label for="email" class="block mx-1 text-lg text-neutral-50">Email address</label>
        <input type="text" id="email" [(ngModel)]="customer.email" #email="ngModel" name="email"
          placeholder="example@email.com" required pattern="^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9\-]+(\.[a-zA-Z]{2,})+$"
          class="text-slate-50 bg-slate-700 border border-gray-300 rounded-lg focus:ring-slate-500 focus:border-slate-500 block w-full p-2.5" />

        @if (email.invalid && email.touched) {
        <p class="pwarning">
          @if (email.errors?.['required']) {
          Email is required.
          } @if (email.errors?.['pattern']) {
          Please enter a valid email address (with full domain).
          }
        </p>
        }

      </div>

      <div class="my-3">
        <label for="phone" class="block mx-1  text-lg text-neutral-50">Phone number (optional)</label>
        <input type="tel" id="tel" [(ngModel)]="customer.phone" #phonenumber="ngModel" name="phonenumber"
          pattern="^\+?[0-9]{1,3}([\- ]?[0-9]{1,4}){2,3}$" placeholder="358-123-4567"
          class="bg-slate-700 border border-gray-300 text-slate-50 rounded-lg focus:ring-slate-500 focus:border-slate-500 block w-full p-2.5" />

        @if (phonenumber.invalid && phonenumber.touched) {
        <p class="pwarning">
          Phone number must be in valid format.
        </p>
        }
      </div>

      <div class="my-3">
        <label for="notes" class="block mx-1 text-lg text-neutral-50">Notes (optional)</label>
        <input type="text" id="notes" [(ngModel)]="customer.notes" #notes="ngModel" name="notes"
          placeholder="Notes about this customer"
          class="bg-slate-700 border border-gray-300 text-slate-50 rounded-lg focus:ring-slate-500 focus:border-slate-500 block w-full p-2.5" />
      </div>

    </form>
  </div>

  @if (openModal) {
  <app-modalcustomer [newcustomer]="customer" (confirm)="handleConfirm($event)" (cancel)="handleCancel()"
    [openModal]="openModal"></app-modalcustomer>
  }
  <div class="absolute bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 p-4 rounded-b-2xl">

    <div class="flex gap-3">
      <button class="flex-1 bg-slate-400 active:bg-slate-500 text-neutral-50 py-2.5 px-4 rounded-lg transition-colors"
        (click)="back()">
        Cancel
      </button>
      <button
        class="flex-1 bg-green-700 hover:bg-green-600 text-neutral-50 py-2.5 px-4 rounded-lg transition-colors disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed"
        (click)="showModal()" [disabled]="!customerForm.valid">
        Continue
      </button>
    </div>

  </div>
</ion-content>