<ion-content [fullscreen]="true">

  @if (showReview) {
  <app-modalentry (cancel)="handleCancel()" [reviewEntry]="newEntry" (confirm)="handleConfirm($event)"></app-modalentry>
  } @else {
  <div class="justify-center">

    <h1 class="text-neutral-50 text-center">Adding a new entry</h1>
    <div class="pcustom text-center">Please ensure that the information is correct.</div>

    <div class="mx-3">

      <div>
        <h3 class="block mb-1 text-xl font-lato text-neutral-50 mx-1 border-gray-600">Customer</h3>

        <!--antaa formiin customerId item_customer.id perusteella-->
        <ng-select [items]="customers" [(ngModel)]="selectedCustomerId" bindValue="customer_id"
          [searchFn]="filteredCustomers" class="custom" required #customerCtrl="ngModel">
          <ng-template ng-option-tmp let-item="item" class="custom">
            {{item.last_name}}, {{item.first_name}}
          </ng-template>
          <ng-template ng-label-tmp let-item="item">
            {{ item.last_name }} {{ item.first_name }}
          </ng-template>
        </ng-select>

        @if (customerCtrl.invalid && customerCtrl.touched) {
        <div class="text-red-400 text-sm">
          Please select a customer.
        </div>
        }
      </div>

      <div>
        <h3 class="text-neutral-50 mx-1">Date</h3>
        <input id="date" type="datetime-local"
          class="border border-gray-600 text-slate-50 bg-slate-800 text-lg rounded-lg block w-full ps-10 p-2.5"
          [(ngModel)]="newEntry.entry_date" name="date" required #dateCtrl="ngModel" />

        @if (dateCtrl.invalid && dateCtrl.touched) {
        <div class="text-red-400 text-sm">
          Date is required.
        </div>
        }

      </div>

      <div>
        <h3 class="text-neutral-50 mx-1">Inks</h3>
        <ion-searchbar class="custom" placeholder="Search" [(ngModel)]="searchInk"></ion-searchbar>
        <div class="scrollable">


          @for (ink of filteredInks(); track ink.user_ink_id) {
          <div class="flex flex-row  justify-center align-center bg-slate-950 my-2 mx-2 p-3">

            <div class="basis-1/3"><img src="{{ink.image_url}}" width="75%" /></div>

            <div class="basis-1/3">
              <p class>{{ink.product_name}} - {{ink.color}} -{{ink.batch_number}}</p>
            </div>

            <div class="basis-1/3"><input class="bg-slate-600 text-neutral-50 font-lato text-l p-5 rounded-2xl mx-2"
                type="button" value="Select" (click)="chooseInk(ink)">
            </div>

          </div>
          }


        </div>
        @if (getChosenInks().length > 0 ) {
        <div class="items-center text-center">
          <ion-badge
            style="--background: rgb(0, 0, 0); padding: 10px; color: white; border-color: white; border-width: 2px; ">{{getChosenInks().length}}</ion-badge>
          <span class="text-2xl font-pt-serif"> Inks chosen</span>

        </div>
        } @else {
        <p>
          At least one ink has to be chosen.
        </p>
        }

      </div>

      <div>
        <h3 class="block mb-1 text-xl font-lato text-neutral-50 mx-1">Comments</h3>
        <textarea id="description" rows="4"
          class="block p-2.5 w-full max-h-28 text-lg text-neutral-100 rounded-lg border bg-slate-800 border-gray-600 "
          placeholder="Write any additional comments here." [(ngModel)]="newEntry.comments"></textarea>
      </div>

      <div class="flex flex-wrap justify-center gap-3 pt-2">
        <button type="button" class="text-red-600 inline-flex items-center border bg-slate-800
                focus:ring-2 focus:outline-none ring-red-800 font-medium 
               rounded-lg text-lg px-4 py-2 text-center" (click)="back()">
          Back
        </button>
        <button (click)="continue()" type="submit"
          class="text-neutral-50 bg-slate-600 focus:ring-2 focus:outline-none 
               focus:ring-slate-400 font-medium rounded-lg text-lg px-4 py-2 text-center disabled:bg-slate-800 disabled:text-gray-400"
          [disabled]="formNotValid()">
          Continue
        </button>
      </div>

    </div>
  </div>
  }

</ion-content>